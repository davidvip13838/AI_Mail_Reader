files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_install_dependencies.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/ondeck
      
      # Install backend dependencies
      echo "=== Installing backend dependencies ==="
      if cd backend && npm install --production --no-audit --no-fund; then
        echo "✓ Backend dependencies installed successfully"
      else
        echo "✗ Backend npm install failed"
        exit 1
      fi
      cd /var/app/ondeck
      
      # Install frontend dependencies and build
      echo "=== Installing frontend dependencies ==="
      if cd frontend && npm install --no-audit --no-fund; then
        echo "✓ Frontend dependencies installed successfully"
      else
        echo "✗ Frontend npm install failed"
        exit 1
      fi
      
      echo "=== Building frontend ==="
      if npm run build; then
        echo "✓ Frontend built successfully"
      else
        echo "✗ Frontend build failed"
        exit 1
      fi
      cd /var/app/ondeck
      
      echo "=== All dependencies installed and frontend built successfully ==="

