files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_install_dependencies.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      set -e
      cd /var/app/ondeck
      
      echo "=== Starting deployment preparation ==="
      
      # Install backend dependencies with optimizations
      echo "Installing backend dependencies..."
      cd backend
      
      # Use npm ci for faster, reliable installs (requires package-lock.json)
      if [ -f "package-lock.json" ]; then
        npm ci --production --no-audit --no-fund --prefer-offline || npm install --production --no-audit --no-fund
      else
        npm install --production --no-audit --no-fund
      fi
      
      cd /var/app/ondeck
      
      # Verify frontend build exists (should be pre-built)
      if [ ! -d "frontend/build" ]; then
        echo "ERROR: Frontend build not found! Please build frontend before deploying."
        echo "Run: cd frontend && npm install && npm run build"
        exit 1
      fi
      
      echo "✓ Backend dependencies installed"
      echo "✓ Frontend build verified"
      echo "=== Deployment preparation complete ==="

